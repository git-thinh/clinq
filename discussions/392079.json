[
  {
    "Id": "900821",
    "ThreadId": "392079",
    "Html": "\r\n<p>Try the following code:</p>\r\n<p></p>\r\n<pre>    public class GroupJoinTestFixture\r\n    {\r\n        public class WrappedString : INotifyPropertyChanged\r\n        {\r\n            public WrappedString(string s)\r\n            {\r\n                Value = s;\r\n            }\r\n\r\n            public string Value { get; set; }\r\n\r\n            #region Implementation of INotifyPropertyChanged\r\n\r\n            public event PropertyChangedEventHandler PropertyChanged;\r\n\r\n            #endregion\r\n        }\r\n\r\n        [Test]\r\n        public void Test()\r\n        {\r\n            ObservableCollection outer = new ObservableCollection { new WrappedString(&quot;hello&quot;), new WrappedString(&quot;aloha&quot;) };\r\n            ObservableCollection inner = new ObservableCollection { new WrappedString(&quot;hello&quot;), new WrappedString(&quot;aloha&quot;) };\r\n            ReadOnlyContinuousCollection inner2 = inner.Where(ws =&gt; ws.Value != &quot;&quot;);\r\n\r\n            ReadOnlyContinuousCollection&gt;&gt; join =\r\n                outer.\r\n                    GroupJoin(inner2,\r\n                              outerItem =&gt; outerItem.Value,\r\n                              innerItem =&gt; innerItem.Value,\r\n                              (outerItem, innerList) =&gt; new RichKeyValuePair&gt;(outerItem, innerList));\r\n            var hasInners =\r\n                join.Where(pair =&gt; pair.Value.Count &gt; 0);\r\n            outer.Clear();\r\n            outer.Add(new WrappedString(&quot;hello&quot;));\r\n            outer.Add(new WrappedString(&quot;aloha&quot;));\r\n            inner.RemoveAt(1);\r\n        }\r\n    }</pre>\r\n<p></p>\r\n<p>&nbsp;</p>\r\n<p>After the last line (inner.RemoveAt(1)) there should be only one item in the hasInners list. But there are two.</p>\r\n<p>When we clear the outer list, GroupJoinReadOnlyContinuousCollection.OnOuterReset is called. It calls RebuildAll which in turn calls RebuildAllInner. But there's no need to rebuild the _keyToInnerLookup, and doing so creates redundant entries in it.</p>\r\n<p>The fix is that OnOuterReset should call RebuildAllOuter instead of RebuildAll.</p>\r\n",
    "PostedDate": "2012-08-17T12:33:55.183-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]